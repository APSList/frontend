<div class="mx-4 my-4">
  <!-- Error -->
  @if (error()) {
    <div class="mt-3 p-3 border-round bg-red-50 text-red-700">
      {{ error() }}
    </div>
  }

  <!-- Table -->
  <p-table
    class="mt-4"
    [value]="rows()"
    dataKey="id"
    [loading]="loading()"
    [rowHover]="true"
    breakpoint="768px"
    sortMode="single"

    [customSort]="true"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id" style="width: 6rem">
          ID <p-sortIcon field="id"></p-sortIcon>
        </th>

        <th pSortableColumn="sessionId">
          Session <p-sortIcon field="sessionId"></p-sortIcon>
        </th>

        <th pSortableColumn="paymentIntentId">
          Intent <p-sortIcon field="paymentIntentId"></p-sortIcon>
        </th>

        <th pSortableColumn="amount" class="text-right">
          Amount <p-sortIcon field="amount"></p-sortIcon>
        </th>

        <th pSortableColumn="paymentMethod">
          Method <p-sortIcon field="paymentMethod"></p-sortIcon>
        </th>

        <th pSortableColumn="status" class="text-center">
          Status <p-sortIcon field="status"></p-sortIcon>
        </th>

        <th pSortableColumn="createdAt">
          Created <p-sortIcon field="createdAt"></p-sortIcon>
        </th>

        <th style="width: 4rem"></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-p>
      <tr class="cursor-pointer" (click)="openDetails(p)">
        <!-- ID -->
        <td>
          <div class="font-medium">#{{ p.id }}</div>
          <div class="text-600 text-sm">
            Org: {{ p.organizationId ?? '—' }}
          </div>
        </td>

        <!-- Session -->
        <td>
          <div class="font-medium">{{ p.sessionId || '—' }}</div>
          <div class="text-600 text-sm">
            Reservation: {{ p.reservationId ?? '—' }}
          </div>
        </td>

        <!-- Intent -->
        <td>
          <div class="font-medium">{{ p.paymentIntentId || '—' }}</div>
          <div class="text-600 text-sm">
            Customer: {{ p.customerId ?? '—' }}
          </div>
        </td>

        <!-- Amount -->
        <td class="text-right">
          <div class="font-medium">
            {{ (p.amount ?? null) === null ? '—' : (p.amount) }}
          </div>
        </td>

        <!-- Method -->
        <td>
          <div class="font-medium">{{ p.paymentMethod || '—' }}</div>
        </td>

        <!-- Status -->
        <td class="text-center">
          <p-tag [value]="p.status" [severity]="statusSeverity(p.status)"></p-tag>
        </td>

        <!-- Created -->
        <td>
          <div class="font-medium">
            {{ p.createdAt ? (p.createdAt) : '—' }}
          </div>
          @if (p.createdBy) {
            <div class="text-600 text-sm">by {{ p.createdBy }}</div>
          }
        </td>

        <!-- Actions -->
        <td class="text-right">
          <p-button
            icon="pi pi-trash"
            severity="danger"
            text
            pTooltip="Delete"
            tooltipPosition="left"
            (onClick)="$event.stopPropagation(); delete(p.id)">
          </p-button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" class="text-center p-4 text-600">
          No payments found.
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
